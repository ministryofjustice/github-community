{% extends "shared/components/base.html" %}

{% block pageTitle %}
   Platform Access Summary
{% endblock %}

{% block content %}
<h1 class="govuk-heading-l">Platform Access Summary</h1>
  <p class="govuk-body">
    This page details all access roles being used across Modernisation Platform environments.
  </p>
  <p class="govuk-body">
    Consult our <a class="govuk-link" href="https://user-guide.modernisation-platform.service.justice.gov.uk/user-guide/platform-user-roles.html">documentation</a> for more information on platform user roles.
  </p>

  <section class="govuk-summary-list govuk-!-margin-bottom-6">
    <h2 class="govuk-heading-m">Access Role Usage</h2>
    {% for role, count in role_counts.items() %}
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">{{ role }}</dt>
      <dd class="govuk-summary-list__value">{{ count }}</dd>
    </div>
    {% endfor %}
  </section>

  <section>
    <h2 class="govuk-heading-m">All Environments and Access</h2>

    <input type="text" id="access-search" class="govuk-input" placeholder="Search apps, environments, group name, access level..." style="margin-bottom: 1em;">
    <table class="govuk-table">
      <thead>
        <tr>
          <th class="govuk-table__header">App Name</th>
          <th class="govuk-table__header">Environment</th>
          <th class="govuk-table__header">Access Level</th>
          <th class="govuk-table__header">Group Name(s)</th>
        </tr>
      </thead>
      <tbody id="access-table-body">
        {% for item in access_items %}
        <tr>
          <td class="govuk-table__cell">{{ item.app_name }}</td>
          <td class="govuk-table__cell">{{ item.environment }}</td>
          <td class="govuk-table__cell">{{ item.access_level }}</td>
          <td class="govuk-table__cell">{% for group in item.groups %}{{ group }}{% if not loop.last %}<br>{% endif %}{% endfor %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
  <script>
    document.getElementById('access-search').addEventListener('input', function() {
      const query = this.value.toLowerCase().trim();
      const terms = query.split(/\s+/);
      const rows = document.querySelectorAll('#access-table-body tr');
      rows.forEach(row => {
        // Gather text from all cells
        const text = Array.from(row.cells).map(cell => cell.textContent.toLowerCase()).join(' ');
        // Show row if all terms match
        const match = terms.every(term => text.includes(term));
        row.style.display = match ? '' : 'none';
      });
    });
  </script>
  
  {% endblock %}
